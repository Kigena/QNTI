<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Money Concepts - QNTI Trading System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c1426 0%, #1a2332 100%);
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .nav-bar {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #334155;
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand {
            font-size: 1.2rem;
            font-weight: bold;
            color: #3b82f6;
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
        }

        .nav-links a {
            color: #94a3b8;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .nav-links a:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .nav-links a.active {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 0;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 15px;
            border: 1px solid rgba(59, 130, 246, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.1rem;
            color: #94a3b8;
            margin-bottom: 20px;
        }

        .nav-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-links a {
            color: #3b82f6;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-links a:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .symbol-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .symbol-selector select {
            transition: all 0.3s ease;
        }
        
        .symbol-selector select:hover {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
        
        .symbol-selector select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .refresh-btn {
            padding: 10px 20px;
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .refresh-btn:hover {
            background: #10b981;
            color: white;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(59, 130, 246, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            border-color: rgba(59, 130, 246, 0.3);
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            font-size: 1.5rem;
            margin-right: 12px;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #e2e8f0;
        }

        .card-content {
            color: #94a3b8;
            line-height: 1.6;
        }

        .status-indicator {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-bullish {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-bearish {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status-neutral {
            background: rgba(156, 163, 175, 0.2);
            color: #9ca3af;
            border: 1px solid rgba(156, 163, 175, 0.3);
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(59, 130, 246, 0.1);
        }

        .metric:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .metric-label {
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .metric-value {
            color: #e2e8f0;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            color: #94a3b8;
            font-style: italic;
        }

        .error {
            color: #ef4444;
            text-align: center;
            font-weight: 500;
        }

        .alerts-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .alert-item {
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .symbol-selector {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <div class="nav-bar">
        <div class="nav-brand">QNTI Trading System</div>
        <div class="nav-links">
            <a href="main_dashboard.html">üìä Dashboard</a>
            <a href="trading_center.html">üìà Trading</a>
            <a href="smc_analysis.html" class="active">üéØ SMC Analysis</a>
            <a href="smc_automation.html">üöÄ SMC Automation</a>
            <a href="ea_management.html">ü§ñ EA Manager</a>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üéØ Smart Money Concepts Dashboard</h1>
            <p>Advanced market structure analysis for professional trading</p>
            <div class="nav-links">
                <a href="main_dashboard.html">‚Üê Main Dashboard</a>
                <a href="trading_center.html">Trading Center</a>
                <a href="forex_advisor_chat.html">Forex Advisor</a>
                <a href="analytics_reports.html">Analytics</a>
                <a href="strategy_tester.html">Strategy Tester</a>
            </div>
        </div>

        <div class="controls">
            <div class="symbol-selector">
                <label for="symbolDropdown" style="color: #94a3b8; margin-right: 10px; font-weight: 600;">Select Symbol:</label>
                <select id="symbolDropdown" onchange="selectSymbol(this.value)" style="padding: 8px 15px; border-radius: 8px; border: 1px solid #374151; background: #1f2937; color: #e2e8f0; font-size: 14px; min-width: 150px;">
                    <optgroup label="Major Forex Pairs">
                        <option value="EURUSD" selected>EUR/USD</option>
                        <option value="GBPUSD">GBP/USD</option>
                        <option value="USDJPY">USD/JPY</option>
                        <option value="USDCHF">USD/CHF</option>
                        <option value="AUDUSD">AUD/USD</option>
                        <option value="USDCAD">USD/CAD</option>
                        <option value="NZDUSD">NZD/USD</option>
                    </optgroup>
                    <optgroup label="Minor Forex Pairs">
                        <option value="EURJPY">EUR/JPY</option>
                        <option value="GBPJPY">GBP/JPY</option>
                        <option value="EURGBP">EUR/GBP</option>
                        <option value="EURAUD">EUR/AUD</option>
                        <option value="GBPAUD">GBP/AUD</option>
                        <option value="AUDCAD">AUD/CAD</option>
                        <option value="AUDCHF">AUD/CHF</option>
                        <option value="CADJPY">CAD/JPY</option>
                        <option value="CHFJPY">CHF/JPY</option>
                        <option value="EURCHF">EUR/CHF</option>
                        <option value="EURCAD">EUR/CAD</option>
                        <option value="GBPCAD">GBP/CAD</option>
                        <option value="GBPCHF">GBP/CHF</option>
                        <option value="NZDCAD">NZD/CAD</option>
                        <option value="NZDJPY">NZD/JPY</option>
                        <option value="AUDNZD">AUD/NZD</option>
                    </optgroup>
                    <optgroup label="Precious Metals">
                        <option value="XAUUSD">XAU/USD (Gold)</option>
                        <option value="XAGUSD">XAG/USD (Silver)</option>
                        <option value="GOLD">GOLD</option>
                        <option value="SILVER">SILVER</option>
                    </optgroup>
                    <optgroup label="Cryptocurrencies">
                        <option value="BTCUSD">BTC/USD</option>
                        <option value="ETHUSD">ETH/USD</option>
                        <option value="LTCUSD">LTC/USD</option>
                        <option value="XRPUSD">XRP/USD</option>
                        <option value="ADAUSD">ADA/USD</option>
                    </optgroup>
                    <optgroup label="Indices">
                        <option value="US30Cash">US30 (Dow Jones)</option>
                        <option value="US500Cash">US500 (S&P 500)</option>
                        <option value="US100Cash">US100 (Nasdaq)</option>
                        <option value="DE40Cash">DE40 (DAX)</option>
                        <option value="UK100Cash">UK100 (FTSE)</option>
                        <option value="JP225Cash">JP225 (Nikkei)</option>
                        <option value="AUS200Cash">AUS200 (ASX)</option>
                        <option value="HK50Cash">HK50 (Hang Seng)</option>
                        <option value="USDX">USDX (Dollar Index)</option>
                    </optgroup>
                    <optgroup label="Commodities">
                        <option value="WTICASH">WTI Oil</option>
                        <option value="BRENTCASH">Brent Oil</option>
                        <option value="NATGASCASH">Natural Gas</option>
                    </optgroup>
                </select>
            </div>
            <button class="refresh-btn" onclick="refreshAnalysis()">
                <i class="fas fa-sync-alt"></i> Refresh Analysis
            </button>
        </div>

        <div class="dashboard">
            <!-- Market Structure Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üìä</div>
                    <div class="card-title">Market Structure</div>
                </div>
                <div class="card-content" id="market-structure">
                    <div class="loading">Loading market structure...</div>
                </div>
            </div>

            <!-- Order Blocks Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üß±</div>
                    <div class="card-title">Order Blocks</div>
                </div>
                <div class="card-content" id="order-blocks">
                    <div class="loading">Loading order blocks...</div>
                </div>
            </div>

            <!-- Fair Value Gaps Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">‚ö°</div>
                    <div class="card-title">Fair Value Gaps</div>
                </div>
                <div class="card-content" id="fair-value-gaps">
                    <div class="loading">Loading fair value gaps...</div>
                </div>
            </div>

            <!-- Key Levels Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üéØ</div>
                    <div class="card-title">Key Levels</div>
                </div>
                <div class="card-content" id="key-levels">
                    <div class="loading">Loading key levels...</div>
                </div>
            </div>

            <!-- Premium/Discount Zones Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üåä</div>
                    <div class="card-title">Premium/Discount Zones</div>
                </div>
                <div class="card-content" id="zones">
                    <div class="loading">Loading zones...</div>
                </div>
            </div>

            <!-- Alerts Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üö®</div>
                    <div class="card-title">Active Alerts</div>
                </div>
                <div class="card-content" id="alerts">
                    <div class="loading">Loading alerts...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentSymbol = 'EURUSD';
        let refreshInterval;

        function selectSymbol(symbol) {
            currentSymbol = symbol;
            console.log(`Selected symbol: ${symbol}`);
            
            // Update the dropdown selection (in case called programmatically)
            const dropdown = document.getElementById('symbolDropdown');
            if (dropdown.value !== symbol) {
                dropdown.value = symbol;
            }
            
            // Update page title to show current symbol
            document.querySelector('.header h1').innerHTML = `üéØ Smart Money Concepts - ${symbol}`;
            
            // Load new data
            loadSMCData();
        }

        function refreshAnalysis() {
            loadSMCData();
        }

        async function loadSMCData() {
            try {
                // Show loading states
                document.getElementById('market-structure').innerHTML = '<div class="loading">Loading market structure...</div>';
                document.getElementById('order-blocks').innerHTML = '<div class="loading">Loading order blocks...</div>';
                document.getElementById('fair-value-gaps').innerHTML = '<div class="loading">Loading fair value gaps...</div>';
                document.getElementById('key-levels').innerHTML = '<div class="loading">Loading key levels...</div>';
                document.getElementById('zones').innerHTML = '<div class="loading">Loading zones...</div>';
                document.getElementById('alerts').innerHTML = '<div class="loading">Loading alerts...</div>';

                const response = await fetch(`/api/smc/analyze/${currentSymbol}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Update market structure
                updateMarketStructure(data.summary);
                
                // Update order blocks
                updateOrderBlocks(data.summary);
                
                // Update fair value gaps
                updateFairValueGaps(data.summary);
                
                // Update key levels
                updateKeyLevels(data.summary);
                
                // Update zones
                updateZones(data.summary);
                
                // Update alerts
                updateAlerts(data.summary);
                
            } catch (error) {
                console.error('Error loading SMC data:', error);
                showError('Failed to load SMC data. Please try again.');
            }
        }

        function updateMarketStructure(data) {
            const trendClass = data.swing_trend === 'BULLISH' ? 'status-bullish' : 
                              data.swing_trend === 'BEARISH' ? 'status-bearish' : 'status-neutral';
            
            const html = `
                <div class="metric">
                    <span class="metric-label">Swing Trend</span>
                    <span class="status-indicator ${trendClass}">${data.swing_trend || 'Unknown'}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Internal Trend</span>
                    <span class="status-indicator ${data.internal_trend === 'BULLISH' ? 'status-bullish' : 
                                                   data.internal_trend === 'BEARISH' ? 'status-bearish' : 'status-neutral'}">
                        ${data.internal_trend || 'Unknown'}
                    </span>
                </div>
                <div class="metric">
                    <span class="metric-label">Swing High</span>
                    <span class="metric-value">${data.swing_high ? data.swing_high.toFixed(5) : 'N/A'}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Swing Low</span>
                    <span class="metric-value">${data.swing_low ? data.swing_low.toFixed(5) : 'N/A'}</span>
                </div>
            `;
            
            document.getElementById('market-structure').innerHTML = html;
        }

        function updateOrderBlocks(data) {
            const swingBlocks = data.order_blocks_count?.swing || 0;
            const internalBlocks = data.order_blocks_count?.internal || 0;
            
            const html = `
                <div class="metric">
                    <span class="metric-label">Swing Order Blocks</span>
                    <span class="metric-value">${swingBlocks}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Internal Order Blocks</span>
                    <span class="metric-value">${internalBlocks}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Total Active</span>
                    <span class="metric-value">${swingBlocks + internalBlocks}</span>
                </div>
            `;
            
            document.getElementById('order-blocks').innerHTML = html;
        }

        function updateFairValueGaps(data) {
            const fvgCount = data.fair_value_gaps_count || 0;
            
            const html = `
                <div class="metric">
                    <span class="metric-label">Active FVGs</span>
                    <span class="metric-value">${fvgCount}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Bullish FVGs</span>
                    <span class="metric-value">${Math.floor(fvgCount * 0.6)}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Bearish FVGs</span>
                    <span class="metric-value">${Math.floor(fvgCount * 0.4)}</span>
                </div>
            `;
            
            document.getElementById('fair-value-gaps').innerHTML = html;
        }

        function updateKeyLevels(data) {
            const equalHighs = data.equal_highs_count || 0;
            const equalLows = data.equal_lows_count || 0;
            const breakouts = data.structure_breakouts_count || 0;
            
            const html = `
                <div class="metric">
                    <span class="metric-label">Equal Highs</span>
                    <span class="metric-value">${equalHighs}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Equal Lows</span>
                    <span class="metric-value">${equalLows}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Structure Breakouts</span>
                    <span class="metric-value">${breakouts}</span>
                </div>
            `;
            
            document.getElementById('key-levels').innerHTML = html;
        }

        function updateZones(data) {
            const zones = data.zones || {};
            
            const html = `
                <div class="metric">
                    <span class="metric-label">Premium Zone</span>
                    <span class="metric-value">
                        ${zones.premium ? `${zones.premium[0].toFixed(5)} - ${zones.premium[1].toFixed(5)}` : 'N/A'}
                    </span>
                </div>
                <div class="metric">
                    <span class="metric-label">Equilibrium</span>
                    <span class="metric-value">
                        ${zones.equilibrium ? `${zones.equilibrium[0].toFixed(5)} - ${zones.equilibrium[1].toFixed(5)}` : 'N/A'}
                    </span>
                </div>
                <div class="metric">
                    <span class="metric-label">Discount Zone</span>
                    <span class="metric-value">
                        ${zones.discount ? `${zones.discount[0].toFixed(5)} - ${zones.discount[1].toFixed(5)}` : 'N/A'}
                    </span>
                </div>
            `;
            
            document.getElementById('zones').innerHTML = html;
        }

        function updateAlerts(data) {
            const alerts = data.alerts || {};
            
            let alertsHtml = '<div class="alerts-list">';
            
            if (alerts.swing_alerts && alerts.swing_alerts.length > 0) {
                alerts.swing_alerts.forEach(alert => {
                    alertsHtml += `<div class="alert-item">üîî Swing: ${alert}</div>`;
                });
            }
            
            if (alerts.internal_alerts && alerts.internal_alerts.length > 0) {
                alerts.internal_alerts.forEach(alert => {
                    alertsHtml += `<div class="alert-item">‚ö° Internal: ${alert}</div>`;
                });
            }
            
            if (alerts.order_block_alerts && alerts.order_block_alerts.length > 0) {
                alerts.order_block_alerts.forEach(alert => {
                    alertsHtml += `<div class="alert-item">üß± Order Block: ${alert}</div>`;
                });
            }
            
            if (alerts.fvg_alerts && alerts.fvg_alerts.length > 0) {
                alerts.fvg_alerts.forEach(alert => {
                    alertsHtml += `<div class="alert-item">‚ö° FVG: ${alert}</div>`;
                });
            }
            
            alertsHtml += '</div>';
            
            if (alertsHtml === '<div class="alerts-list"></div>') {
                alertsHtml = '<div class="metric"><span class="metric-label">No active alerts</span></div>';
            }
            
            document.getElementById('alerts').innerHTML = alertsHtml;
        }

        function showError(message) {
            const errorHtml = `<div class="error">${message}</div>`;
            document.getElementById('market-structure').innerHTML = errorHtml;
            document.getElementById('order-blocks').innerHTML = errorHtml;
            document.getElementById('fair-value-gaps').innerHTML = errorHtml;
            document.getElementById('key-levels').innerHTML = errorHtml;
            document.getElementById('zones').innerHTML = errorHtml;
            document.getElementById('alerts').innerHTML = errorHtml;
        }

        // Initialize page
        window.addEventListener('load', () => {
            loadSMCData();
            
            // Set up auto-refresh every 30 seconds
            refreshInterval = setInterval(loadSMCData, 30000);
        });

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });
    </script>
</body>
</html> 